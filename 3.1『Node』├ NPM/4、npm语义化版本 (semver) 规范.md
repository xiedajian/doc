[参考](https://juejin.im/post/5ab3f77df265da2392364341)

# 语义化版本 (semver) 规范

语义化版本 (semver) 规范，作为依赖版本管理方案。

semver 约定一个包的版本号必须包含3个数字，格式必须为 MAJOR.MINOR.PATCH, 意为 主版本号.小版本号.修订版本号.

- MAJOR 对应大的版本号迭代，做了不兼容旧版的修改时要更新 MAJOR 版本号
- MINOR 对应小版本迭代，发生兼容旧版API的修改或功能更新时，更新MINOR版本号
- PATCH 对应修订版本号，一般针对修复 BUG 的版本号


# npm version

npm 要求在 publish 之前，必须更新版本号。

npm 提供了 npm version 工具，执行 

```
$ npm version [<newversion> | major | minor | patch | premajor | preminor | prepatch | prerelease [--preid=<prerelease-id>] | from-git] 
```

可以简单地将版本号中相应的数字加1.

详细解释如下：
```
newversion：自定义版本号，除了已经发布的版本号，想写啥写啥
major：升级主版本号 1.0.0 -> 2.0.0
minor：升级次版本号 1.0.0 -> 1.1.0
patch：升级补丁号 1.0.0 -> 1.0.1  
premajor：预备主版本
preminor：预备次版本
prerelease：预发布版本
```


# 版本使用

对于包的引用者来说，我们需要在 dependencies 中使用 semver 约定的 semver range 指定所需依赖包的版本号或版本范围。

npm 提供了网站 https://semver.npmjs.com 可方便地计算所输入的表达式的匹配范围。常用的规则示例如下表：

```
range
含义
例




^2.2.1
指定的 MAJOR 版本号下, 所有更新的版本
匹配 2.2.3, 2.3.0; 不匹配 1.0.3, 3.0.1


~2.2.1
指定 MAJOR.MINOR 版本号下，所有更新的版本
匹配 2.2.3, 2.2.9 ; 不匹配 2.3.0, 2.4.5


>=2.1
版本号大于或等于 2.1.0
匹配 2.1.2, 3.1


<=2.2
版本号小于或等于 2.2
匹配 1.0.0, 2.2.1, 2.2.11


1.0.0 - 2.0.0
版本号从 1.0.0 (含) 到 2.0.0 (含)
匹配 1.0.0, 1.3.4, 2.0.0

```

任意两条规则，用空格连接起来，表示“与”逻辑，即两条规则的交集:
如 `>=2.3.1 <=2.8.0` 可以解读为: >=2.3.1 且 <=2.8.0

可以匹配 2.3.1, 2.4.5, 2.8.0
但不匹配 1.0.0, 2.3.0, 2.8.1, 3.0.0

任意两条规则，通过 || 连接起来，表示“或”逻辑，即两条规则的并集:

如 `^2 >=2.3.1 || ^3 >3.2`

可以匹配 2.3.1, 2,8.1, 3.3.1
但不匹配 1.0.0, 2.2.0, 3.1.0, 4.0.0


PS: 除了这几种，还有如下更直观的表示版本号范围的写法:

- * 或 x 匹配所有主版本
- 1 或 1.x 匹配 主版本号为 1 的所有版本
- 1.2 或 1.2.x 匹配 版本号为 1.2 开头的所有版本


## 预发布版本

在常规仅包含数字的版本号之外，semver 还允许在 MAJOR.MINOR.PATCH 后追加 - 后跟点号分隔的标签，作为预发布版本标签

通常被视为不稳定、不建议生产使用的版本。

例如：
```
1.0.0-alpha
1.0.0-beta.1
1.0.0-rc.3
```


上表中我们最常见的是 ^1.8.11 这种格式的 range, 因为我们在使用 npm install <package name> 安装包时，npm 默认安装当前最新版本，例如 1.8.11, 然后在所安装的版本号前加^号, 将 ^1.8.11 写入 package.json 依赖配置，意味着可以匹配 1.8.11 以上，2.0.0 以下的所有版本。


## 版本号^的坑

npm中依赖版本号是 ^x.y.z，可以包含哪些版本呢？

版本号 ^0.12.0 ，真的包含了 0.13.1 么？

再翻出 npm版本官方文档 看看，嗯，之前的确理解错了。

文档里明确说了，^指明的版本范围，只要不修改 [major, minor, patch] 三元组中，
最左侧的第一个非0位，都是可以的。
也就是说，要确定 ^版本包含的范围，先要找到 最左侧的第一个非0位 ，只有在这一位右侧的变动，才被包含在这个 ^ 指定的范围内。

举个例子：

^1.2.3版本包括：>= 1.2.3 并且 < 2.0.0
^0.2.3版本包括：>= 0.2.3 并且 < 0.3.0
^0.0.3版本包括：>= 0.0.3 并且 < 0.0.4